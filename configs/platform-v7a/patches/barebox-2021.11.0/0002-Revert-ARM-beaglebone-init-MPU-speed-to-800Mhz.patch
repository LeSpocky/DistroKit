From 9c1a78f959dd751c9b8ceb31e44926afc89d7769 Mon Sep 17 00:00:00 2001
From: Ahmad Fatoum <a.fatoum@pengutronix.de>
Date: Fri, 3 Dec 2021 19:51:54 +0100
Subject: [PATCH 2/2] Revert "ARM: beaglebone: init MPU speed to 800Mhz"
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Commit 130c7d6715e9 ("ARM: beaglebone: init MPU speed to 800Mhz") causes
warm reboot from within Linux v5.14.0 to no longer succeed.
barebox MLO is entered, but hangs. Reset from within barebox is
unaffected.
This can be reproduced using DistroKit 949c5ef2b9a6 ("v7a: barebox:
version bump v2021.08.0 â†’ v2021.11.0") on a Beaglebone Black.
Until that's figured out, revert the commit; functional reboot is more
important than the quicker boot up.

This reverts commit 130c7d6715e932a1e0b3e026fea97f700ab33ea9.

Fixes: 130c7d6715e9 ("ARM: beaglebone: init MPU speed to 800Mhz")
Reported-by: arwie # IRC
Cc: Marc Reilly <marc@cpdesign.com.au>
Signed-off-by: Ahmad Fatoum <a.fatoum@pengutronix.de>
Link: https://lore.barebox.org/20211203185154.388145-1-a.fatoum@pengutronix.de
Signed-off-by: Sascha Hauer <s.hauer@pengutronix.de>
---
 arch/arm/boards/beaglebone/lowlevel.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/arch/arm/boards/beaglebone/lowlevel.c b/arch/arm/boards/beaglebone/lowlevel.c
index 31211448f5e8..91d143e4150b 100644
--- a/arch/arm/boards/beaglebone/lowlevel.c
+++ b/arch/arm/boards/beaglebone/lowlevel.c
@@ -126,7 +126,7 @@ static noinline int beaglebone_sram_init(void)
 
 	/* Setup the PLLs and the clocks for the peripherals */
 	if (is_beaglebone_black()) {
-		am33xx_pll_init(MPUPLL_M_800, DDRPLL_M_400);
+		am33xx_pll_init(MPUPLL_M_500, DDRPLL_M_400);
 		am335x_sdram_init(0x18B, &ddr3_cmd_ctrl, &ddr3_regs,
 				&ddr3_data);
 	} else {
-- 
2.30.2

